{"ast":null,"code":"var _jsxFileName = \"/Users/kiritoshimura/Desktop/coffee-app/src/App.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport './App.css';\nimport { newCart } from './store/index'; // firebase\n\nimport firebase from \"firebase/compat/app\";\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport \"firebase/compat/auth\";\nimport 'firebase/compat/firestore'; // react\n\nimport { Switch, Route, useHistory // useParams,  \n} from 'react-router-dom';\nimport Cart from './views/Cart';\nimport ItemDetail from './views/ItemDetail';\nimport ItemView from './views/ItemView';\nimport OrderConfirm from './views/OrderConfirm';\nimport OrderFinish from './views/OrderFinish';\nimport OrderHistory from './views/OrderHistory';\nimport './store/index'; // material ui\n\nimport Button from '@material-ui/core/Button';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport React, { useEffect } from \"react\";\nimport { AppBar, Toolbar } from \"@material-ui/core\"; // material ui icon\n\nimport LockOpenIcon from '@material-ui/icons/LockOpen';\nimport LockIcon from '@material-ui/icons/Lock';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport HistoryIcon from '@material-ui/icons/History';\nimport CheckIcon from '@material-ui/icons/Check'; // axios\n\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction HistoryApp(props) {\n  _s();\n\n  const history = useHistory();\n\n  const handleLink = path => history.push(path);\n\n  let newDOM = '';\n  if (props.tag === 'img') newDOM = /*#__PURE__*/_jsxDEV(\"img\", {\n    src: props.context,\n    alt: \"\\u30ED\\u30B4\",\n    onClick: () => handleLink(props.link),\n    children: \" \"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 38\n  }, this);\n  if (props.tag === 'button') newDOM = /*#__PURE__*/_jsxDEV(Button, {\n    onClick: () => handleLink(props.link),\n    children: [props.icon, props.name]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 44,\n    columnNumber: 41\n  }, this);\n  if (props.tag === 'button_img') newDOM = /*#__PURE__*/_jsxDEV(Button, {\n    onClick: () => handleLink(props.link),\n    children: /*#__PURE__*/_jsxDEV(\"img\", {\n      src: props.context,\n      alt: \"\\u30ED\\u30B4\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 92\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 45,\n    columnNumber: 45\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: newDOM\n  }, void 0, false);\n}\n\n_s(HistoryApp, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c = HistoryApp;\n\nfunction App(props) {\n  _s2();\n\n  const dispatch = useDispatch();\n  const state = useSelector(state => state);\n  const history = useHistory();\n\n  const handleLink = path => history.push(path);\n\n  const login = () => {\n    const google_auth_provider = new firebase.auth.GoogleAuthProvider();\n    firebase.auth().signInWithRedirect(google_auth_provider);\n  };\n\n  const logout = () => {\n    firebase.auth().signOut().then(() => {\n      dispatch({\n        type: 'UPDATE_USER',\n        payload: {\n          user: {}\n        }\n      });\n      handleLink('/');\n    });\n  };\n\n  const check = () => {\n    console.log(state);\n  };\n\n  const fetchItems = () => {\n    firebase.firestore().collection(`Items`).get().then(querySnapshot => {\n      querySnapshot.forEach(doc => {\n        dispatch({\n          type: 'FETCH_ITEM',\n          payload: {\n            Items: doc.data()\n          }\n        });\n      });\n    });\n  };\n\n  const fetchCarts = async () => {\n    const setCart = Object.assign({}, newCart);\n    let cartUid = ''; // 途中ログインの場合\n\n    if (localStorage.getItem('middle_login')) {\n      const newCartItemList = JSON.parse(localStorage.getItem('cart')).cartItemList;\n      setCart.cartItemList = newCartItemList;\n    }\n\n    await firebase.firestore().collection(`users/${state.user.uid}/carts`).get().then(querySnapshot => {\n      if (querySnapshot.empty) {\n        createCarts(setCart);\n      } else {\n        querySnapshot.forEach(doc => {\n          let cartMergeUid = doc.data();\n          cartMergeUid.uid = doc.id;\n          cartUid = doc.id;\n          if (doc.data().status === 0) dispatch({\n            type: 'FETCH_CART',\n            payload: {\n              cart: cartMergeUid\n            }\n          });\n          if (doc.data().status !== 0) dispatch({\n            type: 'FETCH_ORDERHISTORY',\n            payload: {\n              orderhistory: doc.data(),\n              uid: doc.id\n            }\n          });\n        });\n      }\n    }); //　途中ログイン処理\n\n    if (localStorage.getItem('middle_login')) {\n      localStorage.removeItem('middle_login');\n      updateCart(setCart, cartUid);\n      handleLink('/orderconfirm');\n    }\n  };\n\n  const start = () => {\n    const auth = getAuth();\n    onAuthStateChanged(auth, user => {\n      if (user) {\n        dispatch({\n          type: 'UPDATE_USER',\n          payload: {\n            user\n          }\n        });\n      }\n    });\n  };\n\n  const updateCart = (setCart, cuid) => {\n    const newCarts = Object.assign({}, setCart);\n    newCarts.uid = cuid;\n    firebase.firestore().collection(`users/${state.user.uid}/carts`).doc(cuid).update(setCart).then(querySnapshot => {\n      dispatch({\n        type: 'UPDATE_CART',\n        payload: {\n          cart: newCarts\n        }\n      });\n    });\n  };\n\n  const createCarts = createCart => {\n    firebase.firestore().collection(`users/${state.user.uid}/carts`).add(createCart).then(d => {\n      const newCarts = Object.assign({}, createCart);\n      newCarts.uid = d.id;\n      dispatch({\n        type: 'CREATE_CART',\n        payload: {\n          cart: newCarts\n        }\n      });\n    });\n  };\n\n  const getAddress = () => {\n    axios.get('https://zipcloud.ibsnet.co.jp/api/search', {\n      withCredentials: true,\n      params: {\n        zipcode: 7830060\n      }\n    }).then(res => {\n      console.log(res);\n    });\n  };\n\n  useEffect(() => {\n    if (state.user && state.user.uid) {\n      fetchCarts();\n      console.log(\"user uid = \" + state.user.uid);\n    }\n  }, [state.user]);\n  useEffect(() => {\n    start();\n    fetchItems();\n    getAddress();\n  }, []);\n  const userNameStyle = {\n    margin: '1%'\n  };\n  const imgStyle = {\n    display: 'inline',\n    width: '3%',\n    height: '3%',\n    margin: '5px'\n  };\n  const header = {\n    display: 'flex',\n    fontSize: '60%'\n  };\n  const logo = {\n    display: 'block',\n    textAlign: 'left'\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(AppBar, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: logo,\n        children: /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button_img\",\n          link: \"/\",\n          context: `${process.env.PUBLIC_URL}/header_logo.png`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 27\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"App-header\",\n        children: [state.user && state.user.displayName ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            onClick: logout,\n            children: [/*#__PURE__*/_jsxDEV(LockIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 36\n            }, this), \"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: state.user.photoURL,\n            style: imgStyle,\n            alt: \"\\u30E6\\u30FC\\u30B6\\u30FC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: userNameStyle,\n            children: state.user.displayName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(Button, {\n          onClick: login,\n          children: [/*#__PURE__*/_jsxDEV(LockOpenIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 33\n          }, this), \"\\u30ED\\u30B0\\u30A4\\u30F3\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: check,\n          children: [/*#__PURE__*/_jsxDEV(CheckIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 33\n          }, this), \"\\u30C1\\u30A7\\u30C3\\u30AF\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button\",\n          link: \"/cart\",\n          icon: /*#__PURE__*/_jsxDEV(ShoppingCartIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 53\n          }, this),\n          name: \"\\u30AB\\u30FC\\u30C8\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button\",\n          link: \"/orderhistory\",\n          icon: /*#__PURE__*/_jsxDEV(HistoryIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 61\n          }, this),\n          name: \"\\u6CE8\\u6587\\u5C65\\u6B74\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/\",\n          exact: true,\n          component: ItemView\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/cart\",\n          exact: true,\n          component: Cart\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/itemdetail/:Item_id\",\n          exact: true,\n          component: ItemDetail\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderconfirm\",\n          exact: true,\n          component: OrderConfirm\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderfinish\",\n          exact: true,\n          component: OrderFinish\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderhistory\",\n          exact: true,\n          component: OrderHistory\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Not found\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 201,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(App, \"6uDuAbugGf/a2mwgkB9NLqFg4CM=\", false, function () {\n  return [useDispatch, useSelector, useHistory];\n});\n\n_c2 = App;\nexport default App;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"HistoryApp\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"sources":["/Users/kiritoshimura/Desktop/coffee-app/src/App.js"],"names":["newCart","firebase","getAuth","onAuthStateChanged","Switch","Route","useHistory","Cart","ItemDetail","ItemView","OrderConfirm","OrderFinish","OrderHistory","Button","useDispatch","useSelector","React","useEffect","AppBar","Toolbar","LockOpenIcon","LockIcon","ShoppingCartIcon","HistoryIcon","CheckIcon","axios","HistoryApp","props","history","handleLink","path","push","newDOM","tag","context","link","icon","name","App","dispatch","state","login","google_auth_provider","auth","GoogleAuthProvider","signInWithRedirect","logout","signOut","then","type","payload","user","check","console","log","fetchItems","firestore","collection","get","querySnapshot","forEach","doc","Items","data","fetchCarts","setCart","Object","assign","cartUid","localStorage","getItem","newCartItemList","JSON","parse","cartItemList","uid","empty","createCarts","cartMergeUid","id","status","cart","orderhistory","removeItem","updateCart","start","cuid","newCarts","update","createCart","add","d","getAddress","withCredentials","params","zipcode","res","userNameStyle","margin","imgStyle","display","width","height","header","fontSize","logo","textAlign","process","env","PUBLIC_URL","displayName","photoURL"],"mappings":"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","sourcesContent":["import './App.css';\nimport { newCart } from './store/index';\n// firebase\nimport firebase from \"firebase/compat/app\";\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport \"firebase/compat/auth\";\nimport 'firebase/compat/firestore';\n// react\nimport { \n  Switch,\n  Route,  \n  useHistory\n  // useParams,  \n} from 'react-router-dom'\nimport Cart from './views/Cart'\nimport ItemDetail from './views/ItemDetail'\nimport ItemView from './views/ItemView'\nimport OrderConfirm from './views/OrderConfirm'\nimport OrderFinish from './views/OrderFinish'\nimport OrderHistory from './views/OrderHistory'\nimport './store/index'\n\n// material ui\nimport Button from '@material-ui/core/Button';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport React, { useEffect } from \"react\";\nimport { AppBar, Toolbar } from \"@material-ui/core\";\n// material ui icon\nimport LockOpenIcon from '@material-ui/icons/LockOpen';\nimport LockIcon from '@material-ui/icons/Lock';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport HistoryIcon from '@material-ui/icons/History';\nimport CheckIcon from '@material-ui/icons/Check';\n\n// axios\nimport axios from 'axios' \n\nfunction HistoryApp(props){\n  const history = useHistory();\n  const handleLink = path => history.push(path)\n  let newDOM = ''\n  \n  if(props.tag === 'img') newDOM = ( <img src={props.context} alt=\"ロゴ\" onClick={() => handleLink(props.link)} > </img> )\n  if(props.tag === 'button') newDOM = ( <Button onClick={() => handleLink(props.link)}>{props.icon}{props.name}</Button> )\n  if(props.tag === 'button_img') newDOM = ( <Button onClick={() => handleLink(props.link)}><img src={props.context} alt=\"ロゴ\" ></img></Button> )\n\n  return (\n    <>\n    {newDOM}\n    </>\n  )\n}\n\nfunction App(props) {\n  const dispatch = useDispatch();\n  const state = useSelector(state => state);\n  const history = useHistory();\n  const handleLink = path => history.push(path)     \n\n  const login = () => {        \n    const google_auth_provider = new firebase.auth.GoogleAuthProvider();        \n    firebase.auth().signInWithRedirect(google_auth_provider)                                   \n  } \n\n  const logout = () => {                \n    firebase.auth().signOut().then( () => {        \n      dispatch({ type: 'UPDATE_USER', payload: { user: {}}})\n      handleLink('/')\n    })        \n  }\n\n  const check = () => {                \n    console.log(state);       \n  }\n     \n  const fetchItems = () => {    \n    firebase.firestore()\n            .collection(`Items`)\n            .get()\n            .then( querySnapshot => {\n              querySnapshot.forEach( doc => {                                \n                dispatch({ type: 'FETCH_ITEM', payload: { Items: doc.data() }})                  \n              })                        \n            })    \n  }\n  \n  const fetchCarts = async () => {         \n    const setCart = Object.assign({},newCart)\n    let cartUid = ''\n\n    // 途中ログインの場合\n    if(localStorage.getItem('middle_login')){      \n      const newCartItemList = JSON.parse(localStorage.getItem('cart')).cartItemList      \n      setCart.cartItemList = newCartItemList            \n    }\n    \n    await firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)\n            .get()\n            .then( querySnapshot => {                            \n              if(querySnapshot.empty){\n                  createCarts(setCart);\n              }else{\n                querySnapshot.forEach( doc => {\n                  let cartMergeUid = doc.data()\n                  cartMergeUid.uid = doc.id\n                  cartUid = doc.id\n                  if(doc.data().status === 0) dispatch({ type: 'FETCH_CART', payload: { cart: cartMergeUid }}) \n                  if(doc.data().status !== 0) dispatch({ type: 'FETCH_ORDERHISTORY', payload: { orderhistory: doc.data(), uid: doc.id }})\n                })                        \n              }              \n            })\n        \n      //　途中ログイン処理\n      if(localStorage.getItem('middle_login')){\n        localStorage.removeItem('middle_login');\n        updateCart(setCart, cartUid)\n        handleLink('/orderconfirm')\n      }                     \n    }      \n\n  const start = () => {       \n    const auth = getAuth(); \n    onAuthStateChanged(auth, ( user => {      \n      if(user){                 \n        dispatch({ type: 'UPDATE_USER', payload: { user }})\n      }                         \n    }))\n  }\n\n  const updateCart = (setCart, cuid) => {    \n    const newCarts = Object.assign({},setCart)\n    newCarts.uid = cuid\n    firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)\n            .doc(cuid)\n            .update(setCart)\n            .then( querySnapshot => {                                                            \n              dispatch({ type: 'UPDATE_CART', payload: { cart: newCarts }})              \n            })   \n  }\n\n  const createCarts = (createCart) => {    \n    firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)                     \n            .add(createCart)          \n            .then( d => {\n              const newCarts = Object.assign({},createCart)\n              newCarts.uid = d.id\n              dispatch({ type:'CREATE_CART', payload:{ cart: newCarts }})                 \n            }) \n  } \n  \n  const getAddress = () => {\n    axios.get('https://zipcloud.ibsnet.co.jp/api/search'    \n      ,{\n        withCredentials: true ,\n        params:{\n          zipcode:7830060\n      }}\n    ).then(res => {\n      console.log(res);\n    })\n\n  }\n\n  useEffect(()=>{\n    if(state.user && state.user.uid){                  \n      fetchCarts();\n      console.log(\"user uid = \" + state.user.uid);\n    }  \n  },[state.user])  \n\n  useEffect(() => {        \n    start()\n    fetchItems()\n    getAddress()\n  },[])  \n\n  const userNameStyle = {\n    margin: '1%',    \n  }\n  const imgStyle = {\n    display: 'inline',\n    width: '3%',\n    height: '3%',\n    margin: '5px'\n  }\n\n  const header = {\n    display: 'flex',\n    fontSize: '60%',\n  }    \n  \n  const logo = {\n    display: 'block',\n    textAlign: 'left',\n  }\n\n  return (\n    <div className=\"App\">\n      <AppBar>\n        <div style={logo}><HistoryApp tag='button_img' link='/' context={`${process.env.PUBLIC_URL}/header_logo.png`}/></div>        \n\n        <span className='App-header' >\n        { state.user && state.user.displayName ? \n        <>\n          <Button onClick={logout}><LockIcon />ログアウト</Button>\n          <img src={state.user.photoURL} style={imgStyle} alt=\"ユーザー\"/>\n          <span style={userNameStyle}>{state.user.displayName}</span>\n        </>          \n        :\n        <Button onClick={login}><LockOpenIcon />ログイン</Button>\n        }          \n        <Button onClick={check}><CheckIcon />チェック</Button>        \n        <HistoryApp tag='button' link='/cart' icon={<ShoppingCartIcon />} name='カート'/>\n        <HistoryApp tag='button' link='/orderhistory' icon={<HistoryIcon />} name='注文履歴'/>                  \n        </span> \n      </AppBar>     \n            <div>                \n                <Switch>\n                    <Route path='/' exact component={ItemView} />\n                    <Route path='/cart' exact component={Cart} />\n                    <Route path='/itemdetail/:Item_id' exact component={ItemDetail} />\n                    <Route path='/orderconfirm' exact component={OrderConfirm} />\n                    <Route path='/orderfinish' exact component={OrderFinish} />\n                    <Route path='/orderhistory' exact component={OrderHistory} />                                              \n                    <Route>\n                        <p>Not found</p>\n                    </Route>\n                </Switch>\n            </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}