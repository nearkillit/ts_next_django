{"ast":null,"code":"var _jsxFileName = \"/Users/kiritoshimura/Desktop/gitsample/team-front/coffee-app/src/views/Cart.tsx\",\n    _s = $RefreshSig$();\n\nimport * as React from 'react';\nimport 'react-redux';\n// firebase\nimport firebase from \"firebase/compat/app\";\nimport 'firebase/compat/firestore'; // react\n\nimport { DefaultRootState, useDispatch, useSelector } from \"react-redux\";\nimport { useState, useEffect } from \"react\";\nimport { GetItemById } from '../components/Items';\nimport { useHistory } from 'react-router-dom'; // material ui\n\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography'; // material ui icon\n\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport ShopIcon from '@material-ui/icons/Shop';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Cart = () => {\n  _s();\n\n  const dispatch = useDispatch();\n  const state = useSelector(state => state);\n  const [cartItemList, setCartItemList] = useState([]);\n  const history = useHistory();\n\n  const handleLink = path => history.push(path);\n\n  const deleteCart = index => {\n    const newCartItemList = cartItemList.filter((c, i) => i !== index);\n    const newCarts = Object.assign({}, state.cart);\n    newCarts.cartItemList = newCartItemList; // ログインしている場合\n\n    if (state.user && state.user.uid) {\n      firebase.firestore().collection(`users/${state.user.uid}/carts`).doc(state.cart.uid).update(newCarts).then(querySnapshot => {\n        dispatch({\n          type: 'UPDATE_CARTITEMLIST',\n          payload: {\n            cartItemList: newCartItemList\n          }\n        });\n      });\n    } else {\n      dispatch({\n        type: 'UPDATE_CARTITEMLIST',\n        payload: {\n          cartItemList: newCartItemList\n        }\n      });\n    }\n  };\n\n  const order = () => {\n    // ログインしている場合\n    if (state.user && state.user.uid) {\n      handleLink('/orderconfirm');\n    } else {\n      localStorage.setItem('middle_login', String(true));\n      localStorage.setItem('cart', JSON.stringify(state.cart)); // login            \n\n      const google_auth_provider = new firebase.auth.GoogleAuthProvider();\n      firebase.auth().signInWithRedirect(google_auth_provider);\n    }\n  };\n\n  useEffect(() => {\n    let newCartItemList = state.cart.cartItemList;\n\n    if (newCartItemList) {\n      // cartのIDを全て商品情報に変換 Item, Topping, subtotal を追加\n      newCartItemList = newCartItemList.map(c => {\n        c.Item = GetItemById(c.Itemid, state.Coffee);\n        c.Topping = c.toppingid.map(t => GetItemById(t, state.Topping));\n        c.subtotal = (c.Item[c.price] + c.Topping.reduce((ac, cu) => ac + cu[c.price], 0)) * Number(c.number);\n        return c;\n      });\n      setCartItemList(newCartItemList);\n    }\n  }, [state]);\n  const buttonOrder = {\n    fontSize: '24px'\n  };\n  const totalPrice = {\n    color: \"white\",\n    backgroundColor: \"rgb(70, 77, 180)\"\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u30AB\\u30FC\\u30C8\\u5185\\u5BB9\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 5\n    }, this), cartItemList.length !== 0 ? /*#__PURE__*/_jsxDEV(TableContainer, {\n      component: Paper,\n      children: [/*#__PURE__*/_jsxDEV(Table, {\n        \"aria-label\": \"simple table\",\n        children: [/*#__PURE__*/_jsxDEV(TableHead, {\n          className: \"chumon-head\",\n          children: /*#__PURE__*/_jsxDEV(TableRow, {\n            children: [/*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u5546\\u54C1\\u540D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 105,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u30B5\\u30A4\\u30BA\\u3001\\u4FA1\\u683C\\u3001\\u6570\\u91CF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 106,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u30C8\\u30C3\\u30D4\\u30F3\\u30B0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u5408\\u8A08\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u524A\\u9664\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(TableBody, {\n          className: \"chumon\",\n          children: cartItemList.map((c, index) => {\n            return /*#__PURE__*/_jsxDEV(TableRow, {\n              children: [/*#__PURE__*/_jsxDEV(TableCell, {\n                component: \"th\",\n                scope: \"row\",\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  src: `${process.env.PUBLIC_URL}/${c.Item.image}`,\n                  height: \"100px\",\n                  alt: \"\\u5546\\u54C1\",\n                  style: {\n                    borderRadius: 5\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 117,\n                  columnNumber: 17\n                }, this), c.Item.name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 116,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                children: [c.price.replace('price', '') + 'サイズ', \"\\u3001\", c.Item[c.price], \"\\u5186\\u3001\", c.number, \"\\u500B\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 120,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                children: /*#__PURE__*/_jsxDEV(\"ul\", {\n                  children: c.Topping.map((t, i) => {\n                    return /*#__PURE__*/_jsxDEV(\"li\", {\n                      children: [t.name, \"\\u3001\", t[c.price], \"\\u5186\"]\n                    }, i, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 125,\n                      columnNumber: 21\n                    }, this);\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 122,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 121,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                children: [c.subtotal, \"\\u5186\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 130,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  onClick: () => deleteCart(index),\n                  children: [/*#__PURE__*/_jsxDEV(DeleteIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 131,\n                    columnNumber: 69\n                  }, this), \"\\u524A\\u9664\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 131,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 131,\n                columnNumber: 15\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 13\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        style: totalPrice,\n        children: [\"\\u5408\\u8A08\\u91D1\\u984D\\uFF1A\", cartItemList.reduce((a, c) => c.subtotal + a, 0), \"\\u5186\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 5\n    }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h3\",\n      children: \"\\u30AB\\u30FC\\u30C8\\u306B\\u5546\\u54C1\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\\u3002\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }, this), cartItemList.length !== 0 && /*#__PURE__*/_jsxDEV(Button, {\n      style: buttonOrder,\n      onClick: order,\n      className: \"botan\",\n      children: [/*#__PURE__*/_jsxDEV(ShopIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 69\n      }, this), \"\\u6CE8\\u6587\\u306B\\u9032\\u3080\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Cart, \"x3gAoMHv0ZJYDX8+Tcp6UZaNI2U=\", false, function () {\n  return [useDispatch, useSelector, useHistory];\n});\n\n_c = Cart;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["/Users/kiritoshimura/Desktop/gitsample/team-front/coffee-app/src/views/Cart.tsx"],"names":["React","firebase","DefaultRootState","useDispatch","useSelector","useState","useEffect","GetItemById","useHistory","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","Button","Typography","DeleteIcon","ShopIcon","Cart","dispatch","state","cartItemList","setCartItemList","history","handleLink","path","push","deleteCart","index","newCartItemList","filter","c","i","newCarts","Object","assign","cart","user","uid","firestore","collection","doc","update","then","querySnapshot","type","payload","order","localStorage","setItem","String","JSON","stringify","google_auth_provider","auth","GoogleAuthProvider","signInWithRedirect","map","Item","Itemid","Coffee","Topping","toppingid","t","subtotal","price","reduce","ac","cu","Number","number","buttonOrder","fontSize","totalPrice","color","backgroundColor","length","process","env","PUBLIC_URL","image","borderRadius","name","replace","a"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type { VFC } from \"react\"\nimport 'react-redux'\nimport { StoreState, CartState, CartItemListState } from '../type/type'\n\n// firebase\nimport firebase from \"firebase/compat/app\";\nimport 'firebase/compat/firestore';\n// react\nimport { DefaultRootState, useDispatch, useSelector } from \"react-redux\";\nimport { useState, useEffect } from \"react\";\nimport { GetItemById } from '../components/Items'\nimport { useHistory } from 'react-router-dom'\n// material ui\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n\n// material ui icon\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport ShopIcon from '@material-ui/icons/Shop';\n\ndeclare module 'react-redux' {\n  interface DefaultRootState extends StoreState {}\n}\n\nconst Cart: VFC = () => {\n  const dispatch = useDispatch();\n  const state = useSelector((state: DefaultRootState ) => state)\n  const [cartItemList, setCartItemList] = useState<Array<CartItemListState>>([])    \n  const history = useHistory()\n  const handleLink = (path: string) => history.push(path)\n\n  const deleteCart = (index) => {\n    const newCartItemList = cartItemList.filter((c,i) => i !== index)\n    const newCarts = Object.assign({},state.cart) \n    newCarts.cartItemList = newCartItemList  \n    \n    // ログインしている場合\n    if(state.user && state.user.uid){\n      firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)\n            .doc(state.cart.uid)\n            .update(newCarts)\n            .then( querySnapshot => {                                              \n                dispatch({ type: 'UPDATE_CARTITEMLIST', payload: { cartItemList: newCartItemList }})              \n            })   \n    }else{\n      dispatch({ type: 'UPDATE_CARTITEMLIST', payload: { cartItemList: newCartItemList }})\n    }\n    \n  }\n\n  const order = () => {    \n    // ログインしている場合\n    if(state.user && state.user.uid){\n      handleLink('/orderconfirm')\n    }else{\n      localStorage.setItem('middle_login', String(true))\n      localStorage.setItem('cart',JSON.stringify(state.cart))\n      // login            \n      const google_auth_provider = new firebase.auth.GoogleAuthProvider();        \n      firebase.auth().signInWithRedirect(google_auth_provider)                                         \n    }\n\n  }\n\n  useEffect(()=>{\n    let newCartItemList = state.cart.cartItemList\n    if(newCartItemList){\n      // cartのIDを全て商品情報に変換 Item, Topping, subtotal を追加\n      newCartItemList = newCartItemList.map( c => { \n        c.Item = GetItemById(c.Itemid, state.Coffee)\n        c.Topping = c.toppingid.map( t => GetItemById(t, state.Topping) )\n        c.subtotal = ( c.Item[c.price] + c.Topping.reduce((ac,cu) => ac + cu[c.price],0)) * Number(c.number)\n        return c\n      })            \n      setCartItemList(newCartItemList)\n    }            \n  },[state])\n\n  const buttonOrder = {\n    fontSize: '24px',        \n  }\n\n  const totalPrice = {\n    color: \"white\",\n    backgroundColor: \"rgb(70, 77, 180)\"\n  }\n\n  return (\n    <>    \n    <h2>カート内容</h2>\n    {cartItemList.length !== 0 ?  \n    <TableContainer component={Paper}>    \n      <Table aria-label=\"simple table\">\n        <TableHead className='chumon-head'>\n          <TableRow>\n            <TableCell>商品名</TableCell>\n            <TableCell>サイズ、価格、数量</TableCell>\n            <TableCell>トッピング</TableCell>\n            <TableCell>合計</TableCell>\n            <TableCell>削除</TableCell>\n          </TableRow>\n        </TableHead>\n        <TableBody className='chumon'>          \n         {cartItemList.map((c, index) => {            \n            return (\n            <TableRow key={index}>\n              <TableCell component=\"th\" scope=\"row\">\n                <img src={`${process.env.PUBLIC_URL}/${c.Item.image}`} height=\"100px\" alt=\"商品\" style={{borderRadius:5}}/>\n                {c.Item.name}\n              </TableCell>\n              <TableCell>{c.price.replace('price','') + 'サイズ'}、{c.Item[c.price]}円、{c.number}個</TableCell>              \n              <TableCell>\n                <ul>                     \n                {c.Topping.map((t,i) => {                  \n                  return (\n                    <li key={i}>{t.name}、{t[c.price]}円</li>\n                  )\n                })}\n                </ul> \n              </TableCell>\n              <TableCell>{c.subtotal}円</TableCell>\n              <TableCell><Button onClick={ () => deleteCart(index)}><DeleteIcon />削除</Button></TableCell>\n            </TableRow>)\n            })                  \n          }\n        </TableBody>\n      </Table>\n      <Typography variant=\"h6\" style={totalPrice}>合計金額：{cartItemList.reduce( (a,c) => c.subtotal + a, 0 )}円</Typography>\n      </TableContainer>\n      :\n      <Typography variant=\"h3\">カートに商品がありません。</Typography>\n      }\n      <p></p>\n    {cartItemList.length !== 0 &&\n      <Button style={buttonOrder} onClick={order} className='botan'><ShopIcon />注文に進む</Button>\n    }\n    </>\n  );\n}\n\nexport default Cart;\n"]},"metadata":{},"sourceType":"module"}