{"ast":null,"code":"var _jsxFileName = \"/Users/kiritoshimura/Desktop/coffee-app/src/App.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport './App.css';\nimport { newCart } from './store/index'; // firebase\n\nimport firebase from \"firebase/compat/app\";\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport \"firebase/compat/auth\";\nimport 'firebase/compat/firestore'; // react\n\nimport { Switch, Route, useHistory // useParams,  \n} from 'react-router-dom';\nimport Cart from './views/Cart';\nimport ItemDetail from './views/ItemDetail';\nimport ItemView from './views/ItemView';\nimport OrderConfirm from './views/OrderConfirm';\nimport OrderFinish from './views/OrderFinish';\nimport OrderHistory from './views/OrderHistory';\nimport Administrator from './views/Administrator';\nimport './store/index';\nimport { GetDiscountByCoupon } from './components/Items'; // material ui\n\nimport Button from '@material-ui/core/Button';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport React, { useState, useEffect } from \"react\";\nimport { AppBar } from \"@material-ui/core\"; // material ui icon\n\nimport LockOpenIcon from '@material-ui/icons/LockOpen';\nimport LockIcon from '@material-ui/icons/Lock';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport HistoryIcon from '@material-ui/icons/History'; // import CheckIcon from '@material-ui/icons/Check';\n\nimport SupervisorAccountIcon from '@material-ui/icons/SupervisorAccount'; //material ui wether\n// import CssBaseline from '@material-ui/core/CssBaseline';\n// import Typography from '@material-ui/core/Typography';\n// import Container from '@material-ui/core/Container';\n// import Box from '@material-ui/core/Box';\n// axios\n\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction HistoryApp(props) {\n  _s();\n\n  const history = useHistory();\n\n  const handleLink = path => history.push(path);\n\n  const whiteMoji = {\n    color: \"white\"\n  };\n  let newDOM = '';\n  if (props.tag === 'img') newDOM = /*#__PURE__*/_jsxDEV(\"img\", {\n    src: props.context,\n    alt: \"\\u30ED\\u30B4\",\n    onClick: () => handleLink(props.link),\n    children: \" \"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 38\n  }, this);\n  if (props.tag === 'button') newDOM = /*#__PURE__*/_jsxDEV(Button, {\n    style: whiteMoji,\n    onClick: () => handleLink(props.link),\n    children: [props.icon, props.name]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 41\n  }, this);\n  if (props.tag === 'button_img') newDOM = /*#__PURE__*/_jsxDEV(Button, {\n    style: whiteMoji,\n    onClick: () => handleLink(props.link),\n    children: /*#__PURE__*/_jsxDEV(\"img\", {\n      src: props.context,\n      alt: \"\\u30ED\\u30B4\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 110\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 45\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: newDOM\n  }, void 0, false);\n}\n\n_s(HistoryApp, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c = HistoryApp;\n\nfunction App() {\n  _s2();\n\n  const dispatch = useDispatch();\n  const state = useSelector(state => state);\n  const history = useHistory();\n\n  const handleLink = path => history.push(path);\n\n  let [wetherSet, setWetherSet] = useState(\"\");\n  const [getTS, setGetTS] = useState(false);\n\n  const login = () => {\n    const google_auth_provider = new firebase.auth.GoogleAuthProvider();\n    firebase.auth().signInWithRedirect(google_auth_provider);\n  };\n\n  const logout = () => {\n    firebase.auth().signOut().then(() => {\n      dispatch({\n        type: 'UPDATE_USER',\n        payload: {\n          user: {}\n        }\n      });\n      handleLink('/');\n    });\n  };\n\n  const check = () => {\n    console.log(state);\n  }; // 必ず fetchItems内で行う\n\n\n  const fetchTimeSaleByCoffee = () => {\n    //　タイムセール商品の期限切れの削除\n    const deadTimeSaleItem = state.TimeSale.filter(t => {\n      const getDeadLine = new Date(t.deadline);\n      const diff = getDeadLine - new Date();\n      return diff >= 0;\n    });\n    const Coffee = state.Coffee.map(c => {\n      const getTimeSale = deadTimeSaleItem.filter(t => c.id == t.Itemid);\n\n      if (getTimeSale[0]) {\n        c.discount = GetDiscountByCoupon(getTimeSale[0].couponCode, state.Coupon);\n        c.couponCode = getTimeSale[0].couponCode;\n      }\n\n      return c;\n    });\n    dispatch({\n      type: 'FETCH_ITEM',\n      payload: {\n        Items: {\n          Coffee\n        }\n      }\n    });\n    firebase.firestore().collection(`Items`).doc('TimeSale').set({\n      TimeSale: deadTimeSaleItem\n    }).then(querySnapshot => {\n      dispatch({\n        type: 'FETCH_ITEM',\n        payload: {\n          Items: {\n            TimeSale: deadTimeSaleItem\n          }\n        }\n      });\n    });\n    setGetTS(true);\n  };\n\n  const fetchItems = () => {\n    firebase.firestore().collection(`Items`).get().then(querySnapshot => {\n      querySnapshot.forEach(doc => {\n        dispatch({\n          type: 'FETCH_ITEM',\n          payload: {\n            Items: doc.data()\n          }\n        });\n      });\n    });\n  };\n\n  const fetchCarts = async () => {\n    const setCart = Object.assign({}, newCart);\n    let cartUid = ''; // 途中ログインの場合\n\n    if (localStorage.getItem('middle_login')) {\n      const newCartItemList = JSON.parse(localStorage.getItem('cart')).cartItemList;\n      setCart.cartItemList = newCartItemList;\n    }\n\n    await firebase.firestore().collection(`users/${state.user.uid}/carts`).get().then(querySnapshot => {\n      if (querySnapshot.empty) {\n        createCarts(setCart);\n      } else {\n        querySnapshot.forEach(doc => {\n          let cartMergeUid = doc.data();\n          cartMergeUid.uid = doc.id;\n          cartUid = doc.id;\n          if (doc.data().status === 0) dispatch({\n            type: 'FETCH_CART',\n            payload: {\n              cart: cartMergeUid\n            }\n          });\n          if (doc.data().status !== 0) dispatch({\n            type: 'FETCH_ORDERHISTORY',\n            payload: {\n              orderhistory: doc.data(),\n              uid: doc.id\n            }\n          });\n        });\n      }\n    }); //　途中ログイン処理\n\n    if (localStorage.getItem('middle_login')) {\n      localStorage.removeItem('middle_login');\n      updateCart(setCart, cartUid);\n      handleLink('/orderconfirm');\n    }\n  };\n\n  const start = () => {\n    const auth = getAuth();\n    onAuthStateChanged(auth, user => {\n      if (user) {\n        dispatch({\n          type: 'UPDATE_USER',\n          payload: {\n            user\n          }\n        });\n      }\n    });\n  };\n\n  const updateCart = (setCart, cuid) => {\n    const newCarts = Object.assign({}, setCart);\n    newCarts.uid = cuid;\n    firebase.firestore().collection(`users/${state.user.uid}/carts`).doc(cuid).update(setCart).then(querySnapshot => {\n      dispatch({\n        type: 'UPDATE_CART',\n        payload: {\n          cart: newCarts\n        }\n      });\n    });\n  };\n\n  const createCarts = createCart => {\n    firebase.firestore().collection(`users/${state.user.uid}/carts`).add(createCart).then(d => {\n      const newCarts = Object.assign({}, createCart);\n      newCarts.uid = d.id;\n      dispatch({\n        type: 'CREATE_CART',\n        payload: {\n          cart: newCarts\n        }\n      });\n    });\n  };\n\n  const getWether = () => {\n    axios.get('https://weather.tsukumijima.net/api/forecast', {\n      params: {\n        city: \"130010\"\n      }\n    }).then(res => {\n      // console.log(res)\n      const wether = {\n        name: res.data.location.city,\n        date: res.data.forecasts[0].date,\n        detail: res.data.forecasts[0].detail.weather,\n        hai: res.data.forecasts[0].temperature.max.celsius,\n        row: res.data.forecasts[0].temperature.min.celsius,\n        img: res.data.forecasts[0].image.url\n      };\n      setWetherSet(wether);\n    });\n  };\n\n  useEffect(() => {\n    if (state.user && state.user.uid) {\n      fetchCarts();\n      console.log(\"user uid = \" + state.user.uid);\n    }\n  }, [state.user]);\n  useEffect(() => {\n    if (state.Coupon.length !== 0 && state.TimeSale[0] && !getTS) {\n      fetchTimeSaleByCoffee();\n    }\n  }, [state.Coupon, state.TimeSale]);\n  useEffect(() => {\n    start();\n    fetchItems();\n    getWether();\n  }, []);\n  const userStyle = {\n    display: 'inline',\n    width: \"5%\"\n  };\n  const userNameStyle = {\n    margin: '1%',\n    fontSize: \"9px\"\n  };\n  const imgStyle = {\n    display: 'block',\n    width: '3%',\n    height: '3%',\n    marginTop: \"0.6%\"\n  };\n  const weatherStyle = {\n    display: \"flex\",\n    width: \"30%\",\n    height: \"40%\"\n  };\n  const weatherMarkStyle = {\n    display: \"inline\",\n    width: \"20%\",\n    fontSize: \"7px\"\n  };\n  const weatherMathStyle = {\n    display: \"inline\",\n    width: \"70%\",\n    fontSize: \"6px\",\n    textAlign: \"left\",\n    padding: \"0px\"\n  };\n  const whiteMoji = {\n    color: \"white\"\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(AppBar, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App-header1\",\n        children: /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button_img\",\n          link: \"/\",\n          context: `${process.env.PUBLIC_URL}/header_logo.png`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"App-header2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: weatherStyle,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: weatherMarkStyle,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"\\u4ECA\\u65E5\\u306E\\u5929\\u6C17\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n              src: wetherSet.img,\n              width: \"90%\",\n              className: \"weatherIcon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: weatherMathStyle,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              width: \"100%\",\n              children: [\"\\u6700\\u9AD8\\u6C17\\u6E29\\uFF1A\", wetherSet.hai || \"--\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              width: \"100%\",\n              children: [\"\\u6700\\u4F4E\\u6C17\\u6E29\\uFF1A\", wetherSet.row || \"--\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                fontSize: '2px'\n              },\n              children: [\"\\uFF08\", wetherSet.date, \"\\u306E\", wetherSet.name, \"\\uFF09\\u3000\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 9\n        }, this), state.user && state.user.displayName ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: userStyle,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\uFF1A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: userNameStyle,\n              children: state.user.displayName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: state.user.photoURL,\n            style: imgStyle,\n            alt: \"\\u30E6\\u30FC\\u30B6\\u30FC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: logout,\n            style: whiteMoji,\n            children: [/*#__PURE__*/_jsxDEV(LockIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 54\n            }, this), \"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(Button, {\n          onClick: login,\n          style: whiteMoji,\n          children: [/*#__PURE__*/_jsxDEV(LockOpenIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 51\n          }, this), \"\\u30ED\\u30B0\\u30A4\\u30F3\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button\",\n          link: \"/cart\",\n          icon: /*#__PURE__*/_jsxDEV(ShoppingCartIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 53\n          }, this),\n          name: \"\\u30AB\\u30FC\\u30C8\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button\",\n          link: \"/orderhistory\",\n          icon: /*#__PURE__*/_jsxDEV(HistoryIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 61\n          }, this),\n          name: \"\\u6CE8\\u6587\\u5C65\\u6B74\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 9\n        }, this), (state.user.uid === \"oD7bRul05kcE0Ez2oQfH01PKv073\" || state.user.uid === \"zjoltJkfYMMTpJv9zbK7xXTvLdH3\") && /*#__PURE__*/_jsxDEV(HistoryApp, {\n          tag: \"button\",\n          link: \"/administrator\",\n          icon: /*#__PURE__*/_jsxDEV(SupervisorAccountIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 172\n          }, this),\n          name: \"\\u203B\\u7BA1\\u7406\\u8005\\u753B\\u9762\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 119\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/\",\n          exact: true,\n          component: ItemView\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/cart\",\n          exact: true,\n          component: Cart\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/itemdetail/:Item_id\",\n          exact: true,\n          component: ItemDetail\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderconfirm\",\n          exact: true,\n          component: OrderConfirm\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderfinish\",\n          exact: true,\n          component: OrderFinish\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/orderhistory\",\n          exact: true,\n          component: OrderHistory\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/administrator\",\n          exact: true,\n          component: Administrator\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Not found\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 279,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(App, \"Srg0PC0TOr2crbECJllr3XYH0A0=\", false, function () {\n  return [useDispatch, useSelector, useHistory];\n});\n\n_c2 = App;\nexport default App;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"HistoryApp\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"sources":["/Users/kiritoshimura/Desktop/coffee-app/src/App.js"],"names":["newCart","firebase","getAuth","onAuthStateChanged","Switch","Route","useHistory","Cart","ItemDetail","ItemView","OrderConfirm","OrderFinish","OrderHistory","Administrator","GetDiscountByCoupon","Button","useDispatch","useSelector","React","useState","useEffect","AppBar","LockOpenIcon","LockIcon","ShoppingCartIcon","HistoryIcon","SupervisorAccountIcon","axios","HistoryApp","props","history","handleLink","path","push","whiteMoji","color","newDOM","tag","context","link","icon","name","App","dispatch","state","wetherSet","setWetherSet","getTS","setGetTS","login","google_auth_provider","auth","GoogleAuthProvider","signInWithRedirect","logout","signOut","then","type","payload","user","check","console","log","fetchTimeSaleByCoffee","deadTimeSaleItem","TimeSale","filter","t","getDeadLine","Date","deadline","diff","Coffee","map","c","getTimeSale","id","Itemid","discount","couponCode","Coupon","Items","firestore","collection","doc","set","querySnapshot","fetchItems","get","forEach","data","fetchCarts","setCart","Object","assign","cartUid","localStorage","getItem","newCartItemList","JSON","parse","cartItemList","uid","empty","createCarts","cartMergeUid","status","cart","orderhistory","removeItem","updateCart","start","cuid","newCarts","update","createCart","add","d","getWether","params","city","res","wether","location","date","forecasts","detail","weather","hai","temperature","max","celsius","row","min","img","image","url","length","userStyle","display","width","userNameStyle","margin","fontSize","imgStyle","height","marginTop","weatherStyle","weatherMarkStyle","weatherMathStyle","textAlign","padding","process","env","PUBLIC_URL","displayName","photoURL"],"mappings":"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","sourcesContent":["import './App.css';\nimport { newCart } from './store/index';\n// firebase\nimport firebase from \"firebase/compat/app\";\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport \"firebase/compat/auth\";\nimport 'firebase/compat/firestore';\n// react\nimport { \n  Switch,\n  Route,  \n  useHistory\n  // useParams,  \n} from 'react-router-dom'\nimport Cart from './views/Cart'\nimport ItemDetail from './views/ItemDetail'\nimport ItemView from './views/ItemView'\nimport OrderConfirm from './views/OrderConfirm'\nimport OrderFinish from './views/OrderFinish'\nimport OrderHistory from './views/OrderHistory'\nimport Administrator from './views/Administrator'\nimport './store/index'\nimport { GetDiscountByCoupon } from './components/Items'\n\n// material ui\nimport Button from '@material-ui/core/Button';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport React, { useState,useEffect } from \"react\";\nimport { AppBar } from \"@material-ui/core\";\n// material ui icon\nimport LockOpenIcon from '@material-ui/icons/LockOpen';\nimport LockIcon from '@material-ui/icons/Lock';\nimport ShoppingCartIcon from '@material-ui/icons/ShoppingCart';\nimport HistoryIcon from '@material-ui/icons/History';\n// import CheckIcon from '@material-ui/icons/Check';\nimport SupervisorAccountIcon from '@material-ui/icons/SupervisorAccount';\n\n//material ui wether\n// import CssBaseline from '@material-ui/core/CssBaseline';\n// import Typography from '@material-ui/core/Typography';\n// import Container from '@material-ui/core/Container';\n// import Box from '@material-ui/core/Box';\n\n\n// axios\nimport axios from 'axios'\n\nfunction HistoryApp(props){\n  const history = useHistory();\n  const handleLink = path => history.push(path)\n  const whiteMoji = {\n    color: \"white\"\n  }\n  let newDOM = ''\n  \n  if(props.tag === 'img') newDOM = ( <img src={props.context} alt=\"ロゴ\" onClick={() => handleLink(props.link)} > </img> )\n  if(props.tag === 'button') newDOM = ( <Button style={whiteMoji} onClick={() => handleLink(props.link)}>{props.icon}{props.name}</Button> )\n  if(props.tag === 'button_img') newDOM = ( <Button style={whiteMoji} onClick={() => handleLink(props.link)}><img src={props.context} alt=\"ロゴ\" ></img></Button> )\n\n  return (\n    <>\n    {newDOM}\n    </>\n  )\n}\n\nfunction App() {\n  const dispatch = useDispatch();\n  const state = useSelector(state => state);\n  const history = useHistory();\n  const handleLink = path => history.push(path)     \n\n  let [wetherSet,setWetherSet] = useState(\"\")\n  const [ getTS, setGetTS ] = useState(false)\n\n  const login = () => {        \n    const google_auth_provider = new firebase.auth.GoogleAuthProvider();        \n    firebase.auth().signInWithRedirect(google_auth_provider)                                   \n  } \n\n  const logout = () => {                \n    firebase.auth().signOut().then( () => {        \n      dispatch({ type: 'UPDATE_USER', payload: { user: {}}})\n      handleLink('/')\n    })\n  }\n\n  const check = () => {                    \n    console.log(state);       \n  }\n  // 必ず fetchItems内で行う\n  const fetchTimeSaleByCoffee = () => { \n    //　タイムセール商品の期限切れの削除\n    const deadTimeSaleItem = state.TimeSale.filter( t => {            \n      const getDeadLine = new Date(t.deadline)\n      const diff = getDeadLine - new Date()         \n      return diff >= 0\n    })      \n\n    const Coffee = state.Coffee.map( c => {\n      const getTimeSale = deadTimeSaleItem.filter( t => c.id == t.Itemid )      \n      if(getTimeSale[0]){        \n        c.discount = GetDiscountByCoupon(getTimeSale[0].couponCode, state.Coupon)\n        c.couponCode = getTimeSale[0].couponCode\n      }\n      return c      \n    })     \n    dispatch({ type: 'FETCH_ITEM', payload: { Items:{ Coffee } }})    \n    firebase.firestore()\n            .collection(`Items`)\n            .doc('TimeSale')\n            .set({ TimeSale: deadTimeSaleItem }) \n            .then( querySnapshot => {                                                            \n              dispatch({ type: 'FETCH_ITEM', payload: { Items:{ TimeSale: deadTimeSaleItem } }})              \n            })   \n    setGetTS(true)    \n  }      \n\n  const fetchItems = () => {    \n    firebase.firestore()\n            .collection(`Items`)\n            .get()\n            .then( querySnapshot => {\n              querySnapshot.forEach( doc => {                                \n                dispatch({ type: 'FETCH_ITEM', payload: { Items: doc.data() }})                                  \n              })                                                 \n            })    \n  }\n  \n  const fetchCarts = async () => {         \n    const setCart = Object.assign({},newCart)\n    let cartUid = ''\n\n    // 途中ログインの場合\n    if(localStorage.getItem('middle_login')){      \n      const newCartItemList = JSON.parse(localStorage.getItem('cart')).cartItemList      \n      setCart.cartItemList = newCartItemList            \n    }  \n    \n    await firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)\n            .get()\n            .then( querySnapshot => {                            \n              if(querySnapshot.empty){\n                  createCarts(setCart);\n              }else{\n                querySnapshot.forEach( doc => {\n                  let cartMergeUid = doc.data()\n                  cartMergeUid.uid = doc.id\n                  cartUid = doc.id\n                  if(doc.data().status === 0) dispatch({ type: 'FETCH_CART', payload: { cart: cartMergeUid }}) \n                  if(doc.data().status !== 0) dispatch({ type: 'FETCH_ORDERHISTORY', payload: { orderhistory: doc.data(), uid: doc.id }})\n                })                        \n              }              \n            })\n        \n      //　途中ログイン処理\n      if(localStorage.getItem('middle_login')){\n        localStorage.removeItem('middle_login');\n        updateCart(setCart, cartUid)\n        handleLink('/orderconfirm')\n      }                     \n    }      \n\n  const start = () => {       \n    const auth = getAuth(); \n    onAuthStateChanged(auth, ( user => {      \n      if(user){                         \n        dispatch({ type: 'UPDATE_USER', payload: { user }})\n      }                         \n    }))\n  }\n\n  const updateCart = (setCart, cuid) => {    \n    const newCarts = Object.assign({},setCart)\n    newCarts.uid = cuid\n    firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)\n            .doc(cuid)\n            .update(setCart)\n            .then( querySnapshot => {                                                            \n              dispatch({ type: 'UPDATE_CART', payload: { cart: newCarts }})              \n            })   \n  }\n\n  const createCarts = (createCart) => {    \n    firebase.firestore()\n            .collection(`users/${state.user.uid}/carts`)                     \n            .add(createCart)          \n            .then( d => {\n              const newCarts = Object.assign({},createCart)\n              newCarts.uid = d.id\n              dispatch({ type:'CREATE_CART', payload:{ cart: newCarts }})                 \n            }) \n  } \n\n\n\n  const getWether = () =>{\n    axios.get('https://weather.tsukumijima.net/api/forecast',{\n      params:{\n        city:\"130010\"\n      }\n    }).then(res =>{\n      // console.log(res)\n      const wether = {\n          name:res.data.location.city,\n          date:res.data.forecasts[0].date,\n          detail:res.data.forecasts[0].detail.weather,\n          hai:res.data.forecasts[0].temperature.max.celsius,\n          row:res.data.forecasts[0].temperature.min.celsius,\n          img:res.data.forecasts[0].image.url\n        }\n        setWetherSet(wether)\n      })\n    }    \n\n  useEffect(()=>{\n    if(state.user && state.user.uid){                  \n      fetchCarts();\n      console.log(\"user uid = \" + state.user.uid);\n    }  \n  },[state.user])  \n\n  useEffect(()=> {\n    if(state.Coupon.length !== 0 && state.TimeSale[0] && !getTS ){\n      fetchTimeSaleByCoffee()\n    }    \n  },[ state.Coupon, state.TimeSale])  \n\n  useEffect(() => {        \n    start()\n    fetchItems()\n    getWether()  \n  },[])  \n\n  const userStyle = {\n    display: 'inline',\n    width: \"5%\"\n  }\n\n  const userNameStyle = {\n    margin: '1%', \n    fontSize: \"9px\"\n  }\n\n  const imgStyle = {\n    display: 'block',\n    width: '3%',\n    height: '3%',\n    marginTop: \"0.6%\"\n  }  \n  \n  const weatherStyle =  {\n    display: \"flex\",\n    width: \"30%\",\n    height: \"40%\",\n  }\n\n  const weatherMarkStyle =  {\n    display: \"inline\",\n    width: \"20%\",      \n    fontSize: \"7px\",    \n  }\n\n  const weatherMathStyle =  {\n    display: \"inline\",\n    width: \"70%\",   \n    fontSize: \"6px\",\n    textAlign: \"left\",\n    padding: \"0px\"\n  }\n\n  const whiteMoji = {\n    color: \"white\"\n  }\n\n  return (\n    <div className=\"App\">\n      <AppBar>\n      <div className='App-header1'>\n        <HistoryApp tag='button_img' link='/' context={`${process.env.PUBLIC_URL}/header_logo.png`}  />        \n      </div>\n\n        <span className='App-header2' >\n        <div style={weatherStyle}>\n          <div style={weatherMarkStyle}>\n            <span>今日の天気</span>\n            <img src={wetherSet.img} width=\"90%\" className=\"weatherIcon\"/>\n          </div>          \n          <div style={weatherMathStyle}>\n            <p width=\"100%\">最高気温：{wetherSet.hai || \"--\"}</p>\n            <p width=\"100%\">最低気温：{wetherSet.row || \"--\"}</p>\n            <p style={{fontSize:'2px'}}>（{wetherSet.date}の{wetherSet.name}）　</p>\n          </div>\n        </div> \n        { state.user && state.user.displayName ? \n        <>          \n          <div style={userStyle}>\n            <p>ユーザー名：</p>\n            <p style={userNameStyle}>{state.user.displayName}</p>\n            </div>  \n          <img src={state.user.photoURL} style={imgStyle} alt=\"ユーザー\"/>\n          <Button onClick={logout} style={whiteMoji}><LockIcon />ログアウト</Button>                  \n        </>          \n        :\n        <Button onClick={login} style={whiteMoji}><LockOpenIcon />ログイン</Button>\n        }          \n        {/* <Button onClick={check}>チェック</Button>         */}\n        <HistoryApp tag='button' link='/cart' icon={<ShoppingCartIcon />} name='カート'/>\n        <HistoryApp tag='button' link='/orderhistory' icon={<HistoryIcon />} name='注文履歴'/>  \n        {(state.user.uid === \"oD7bRul05kcE0Ez2oQfH01PKv073\" || state.user.uid === \"zjoltJkfYMMTpJv9zbK7xXTvLdH3\" ) && <HistoryApp tag='button' link='/administrator' icon={<SupervisorAccountIcon />} name='※管理者画面'/>}\n        </span> \n      </AppBar>               \n            <div>                \n                <Switch>\n                    <Route path='/' exact component={ItemView} />\n                    <Route path='/cart' exact component={Cart} />\n                    <Route path='/itemdetail/:Item_id' exact component={ItemDetail} />\n                    <Route path='/orderconfirm' exact component={OrderConfirm} />\n                    <Route path='/orderfinish' exact component={OrderFinish} />\n                    <Route path='/orderhistory' exact component={OrderHistory} />  \n                    <Route path='/administrator' exact component={Administrator} />                                              \n                    <Route>\n                        <p>Not found</p>\n                    </Route>\n                </Switch>\n            </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}